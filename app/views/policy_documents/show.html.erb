<% content_for :title, @policy_document.name %>

<%= turbo_stream_from "policy_scan_#{@policy_document.id}" %>

<div class="container mx-auto p-4">
  <div class="my-8">
    <div class="mb-6">
      <%= link_to "â† Back to Policies", policy_documents_path, class: "text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white" %>
    </div>

    <div class="flex justify-between items-start mb-6">
      <div>
        <h1 class="mb-2"><%= @policy_document.name %></h1>
        <% if @policy_document.published_at.present? %>
          <p class="text-sm text-gray-500 dark:text-gray-400">
            Published: <%= @policy_document.published_at.strftime("%B %d, %Y") %>
          </p>
        <% end %>
      </div>

      <%= button_to "Scan for Issues", scan_policy_document_path(@policy_document),
          method: :post, class: "btn btn-secondary",
          form: { data: { turbo_stream: true } } %>
    </div>

    <!-- Scan Status -->
    <div id="scan-status" class="mb-4"></div>

    <!-- Issues Section -->
    <div id="issues-list" class="mb-8">
      <%= render "issues/list", policy_document: @policy_document, issues: @policy_document.issues.open %>
    </div>

    <!-- Policy Content -->
    <div id="policy-content">
      <% if @policy_document.content.present? %>
        <div class="prose dark:prose-invert max-w-none">
          <%= render_markdown(@policy_document.content, strip_title: @policy_document.name) %>
        </div>
      <% else %>
        <p class="text-gray-600 dark:text-gray-400">No content available for this policy.</p>
      <% end %>
    </div>
  </div>
</div>
